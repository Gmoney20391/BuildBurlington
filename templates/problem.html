<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Build Burlington — The Problem</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: {
              50: '#dbeafe',
              100: '#bfdbfe',
              200: '#93c5fd',
              300: '#60a5fa',
              400: '#3b82f6',
              500: '#2563eb',
              600: '#1d4ed8',
              700: '#1e40af',
              800: '#1e3a8a',
              900: '#1a365d',
            }
          },
          boxShadow: {
            'navy': '0 4px 6px -1px rgba(26, 54, 93, 0.1), 0 2px 4px -1px rgba(26, 54, 93, 0.06)',
          }
        }
      }
    }
  </script>
  <style>
    .hero-pattern {
      background: radial-gradient(1200px 600px at 10% -10%, #dbeafe 0%, rgba(219,234,254,0) 60%),
                  radial-gradient(1200px 600px at 110% 10%, #fef3c7 0%, rgba(254,243,199,0) 60%),
                  #0f172a;
    }
    .glass {
      background: rgba(255,255,255,0.6);
      backdrop-filter: saturate(140%) blur(10px);
    }
    .hamburger-line {
      display: block;
      width: 25px;
      height: 3px;
      margin: 5px auto;
      background-color: #4b5563;
      transition: all 0.3s ease;
    }
    
    .hamburger-active .hamburger-line:nth-child(1) {
      transform: translateY(8px) rotate(45deg);
    }
    
    .hamburger-active .hamburger-line:nth-child(2) {
      opacity: 0;
    }
    
    .hamburger-active .hamburger-line:nth-child(3) {
      transform: translateY(-8px) rotate(-45deg);
    }
    
    .mobile-menu {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}
    
    .mobile-menu-open {
      max-height: 500px;
    }
    
    /* Custom breakpoint to prevent hamburger and menu items from showing simultaneously */
    @media (max-width: 950px) {
      .nav-items {
        display: none;
      }
      
      .hamburger-button {
        display: block;
      }
    }
    
    @media (min-width: 951px) {
      .nav-items {
        display: flex;
      }
      
      .hamburger-button {
        display: none;
      }
      
      .mobile-menu {
        display: none;
      }
    }
  </style>
</head>
<body class="font-sans bg-gray-50">
  <!-- Navigation -->
  <nav class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center">
          <a href="/" class="flex items-center py-2 text-blue-600">
            <span class="font-bold text-xl text-navy-900">BuildBurlington</span>
          </a>
        </div>
        
        <!-- Desktop Navigation Items -->
        <div class="nav-items items-center space-x-6">
          <a href="/" class="py-2 text-gray-700 hover:text-blue-600">Home</a>
          <a href="/problem" class="py-2 text-gray-700 hover:text-blue-600">The Problem</a>
          <a href="/solution" class="py-2 text-gray-700 hover:text-blue-600">The Solution</a>
          <a href="/action" class="py-2 text-gray-700 hover:text-blue-600">Take Action</a>
          <a href="/sources" class="py-2 text-gray-700 hover:text-blue-600">Data Sources</a>
          <a href="#" class="py-4 px-6 text-white rounded-lg font-medium transition duration-300 bg-navy-900 hover:bg-navy-800">Support the Policy</a>
        </div>
        
        <!-- Hamburger Button -->
        <div class="hamburger-button">
          <button id="hamburger-btn" class="focus:outline-none">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </button>
        </div>
      </div>
      
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="mobile-menu bg-white">
        <div class="px-2 pt-2 pb-4 space-y-1">
          <a href="/" class="block py-2 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">Home</a>
          <a href="/problem" class="block py-2 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">The Problem</a>
          <a href="/solution" class="block py-2 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">The Solution</a>
          <a href="/action" class="block py-2 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">Take Action</a>
          <a href="/sources" class="block py-2 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">Data Sources</a>
          <a href="#" class="block py-3 px-4 text-white text-center rounded-lg font-medium mt-2 bg-navy-900 hover:bg-navy-800">Support the Policy</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero-pattern text-white">
    <div class="max-w-6xl mx-auto px-4 py-16">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div>
          <h1 class="text-4xl md:text-5xl font-bold leading-tight">The Housing Crisis in Numbers</h1>
          <p class="mt-4 text-lg text-slate-200 max-w-xl">
            Burlington faces a severe affordability crunch. Explore how prices, incomes, rents, vacancy, and population have shifted over time.
          </p>
          <div class="mt-6 flex flex-wrap gap-3">
            <a href="/solution" class="px-5 py-3 rounded-lg bg-white text-blue-700 font-semibold hover:bg-slate-100">Explore the Solution</a>
            <a href="/action" class="px-5 py-3 rounded-lg border border-white/70 text-white hover:bg-white/10">Take Action</a>
          </div>
        </div>
        <div class="glass rounded-xl p-5 shadow-lg">
          <div class="grid grid-cols-3 gap-4">
            <div class="bg-white rounded-xl p-4">
              <div class="text-xs text-slate-500">Price-to-Income</div>
              <div class="text-2xl font-bold text-red-600">12.3×</div>
              <div class="text-[11px] text-slate-500 mt-1">2023, CMHC + StatCan</div>
            </div>
            <div class="bg-white rounded-xl p-4">
              <div class="text-xs text-slate-500">Vacancy</div>
              <div class="text-2xl font-bold text-orange-500">1.8%</div>
              <div class="text-[11px] text-slate-500 mt-1">2024 Oct, CMHC</div>
            </div>
            <div class="bg-white rounded-xl p-4">
              <div class="text-xs text-slate-500">Median 2BR Rent</div>
              <div id="hero-rent" class="text-2xl font-bold text-emerald-700">$1,993</div>
              <div class="text-[11px] text-slate-500 mt-1">Latest, CMHC</div>
            </div>
          </div>
          <p class="text-[12px] text-slate-600 mt-3">
            Sources: CMHC, Statistics Canada, Teranet/National Bank, City of Burlington.
          </p>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="max-w-6xl mx-auto px-4 py-12 space-y-12">

      <!-- Chart 1: Home Prices vs Income (to 2023 only) -->
      <section class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h2 class="text-2xl font-semibold text-navy-900">Home Prices vs. Income (2011–2023)</h2>
            <p class="text-slate-600 mt-1">Prices have outrun incomes, widening the affordability gap.</p>
          </div>
          
        </div>
        <div class="h-96 mt-4">
          <canvas id="price-income-chart"></canvas>
        </div>
        <p class="text-sm text-slate-500 mt-3">Source: Teranet-National Bank HPI, Statistics Canada (clipped to 2023).</p>
      </section>

      <!-- Explanation Section for Price vs Income Chart -->
      <div class="bg-navy-900 text-white rounded-xl p-6">
        <h3 class="text-xl font-semibold mb-3">How Zoning Impacts Affordability</h3>
        <p class="text-sm">Burlington's restrictive zoning laws limit housing supply by prohibiting medium-density housing types like duplexes, triplexes, and townhomes in most residential areas. This artificial scarcity drives up prices as demand far outstrips the limited supply of single-family homes. When housing construction can't keep pace with population growth, prices inevitably rise faster than incomes.</p>
      </div>

      <!-- Timeline Slider Dashboard -->
      <section class="bg-white rounded-xl shadow-md p-6">
        <h2 class="text-2xl font-semibold text-navy-900">How things changed over time</h2>
        <p class="text-slate-600 mt-1">Use the timeline to see vacancy, rents, and housing gap by year.</p>

        <!-- Slider -->
        <div class="mt-5">
          <div class="flex items-center justify-between text-sm text-slate-600">
            <span id="timeline-min">2011</span>
            <span id="timeline-year" class="font-semibold text-slate-900">—</span>
            <span id="timeline-max">2024</span>
          </div>
          <input id="timeline-slider" type="range" min="2011" max="2024" step="1" value="2011"
                class="w-full mt-2 accent-blue-600"/>
        </div>

        <!-- KPI Cards - Centered -->
        <div class="flex justify-center mt-6">
          <div class="grid md:grid-cols-3 gap-4 max-w-3xl">
            <div class="bg-slate-50 rounded-xl p-4">
              <div class="text-xs text-slate-500">Vacancy Rate</div>
              <div id="kpi-vacancy" class="text-2xl font-bold">—</div>
              <div class="text-[11px] text-slate-500 mt-1">CMHC Rental Market Survey</div>
            </div>
            <div class="bg-slate-50 rounded-xl p-4">
              <div class="text-xs text-slate-500">Population</div>
              <div id="kpi-population" class="text-2xl font-bold">—</div>
              <div class="text-[11px] text-slate-500 mt-1">StatCan / City Estimates</div>
            </div>
            <div class="bg-slate-50 rounded-xl p-4">
              <div class="text-xs text-slate-500">Housing Gap</div>
              <div id="kpi-gap" class="text-2xl font-bold">—</div>
              <div class="text-[11px] text-slate-500 mt-1">Dwellings Needed − Current</div>
            </div>
          </div>
        </div>

        <!-- Small trend panels -->
        <div class="grid md:grid-cols-2 gap-4 mt-6">
          <div class="bg-white border border-slate-200 rounded-xl p-4">
            <div class="flex items-center justify-between">
              <h3 class="font-medium text-navy-900">Average Housing Price Over Time</h3>
              <span class="text-xs text-slate-500">2011–2024</span>
            </div>
            <div class="h-64 mt-2"><canvas id="timeline-vr-chart"></canvas></div>
          </div>
          <div class="bg-white border border-slate-200 rounded-xl p-4">
            <div class="flex items-center justify-between">
              <h3 class="font-medium text-navy-900">Housing Gap Over Time</h3>
              <span class="text-xs text-slate-500">2011–2024</span>
            </div>
            <div class="h-64 mt-2"><canvas id="timeline-pop-chart"></canvas></div>
          </div>
        </div>
      </section>

      <!-- City Comparison with Explanation on the Right -->
      <div class="flex flex-col lg:flex-row gap-8">
        <div class="w-full lg:w-2/3">
          <section class="bg-white rounded-xl shadow-md p-6 h-full">
            <h2 class="text-2xl font-semibold text-navy-900">How Burlington compares to other cities</h2>
            <p class="text-slate-600 mt-1">Burlington Underperforms Compared To Most Cities In The GTA. Select A Metric To Compare. </p>

            <div class="mt-4">
              <label for="metric-select" class="block text-sm font-medium text-slate-700 mb-2">Select metric:</label>
              <select id="metric-select" class="w-full md:w-80 px-4 py-2 border border-slate-300 rounded-lg">
                <option value="Price_to_Income_Ratio">Price-to-Income Ratio</option>
                <option value="Avg_Rent_2Bedroom_2024">Average Rent (2 Bedroom)</option>
                <option value="Housing_Starts_Per_1000_People">Housing Starts per 1000 People</option>
                <option value="Vacancy_Rate_2024_Pct">Vacancy Rate</option>
              </select>
            </div>

            <div class="h-96 mt-4">
              <canvas id="comparison-chart"></canvas>
            </div>
            <p class="text-sm text-slate-500 mt-3">Source: Public data from CMHC, Statistics Canada, and municipal reports.</p>
          </section>
        </div>
        <div class="w-full lg:w-1/3 flex items-center">
          <!-- Explanation Section for Comparison Chart (on the right) -->
          <div class="bg-navy-900 text-white rounded-xl p-6 h-full">
            <h3 class="text-xl font-semibold mb-3">Why Burlington Lags Behind</h3>
            <p class="text-sm">Burlington's restrictive zoning policies have created a severe housing supply crisis that explains why our city consistently ranks among the worst in housing metrics compared to neighboring municipalities. While cities like Oakville, Milton, and Hamilton have modernized their zoning bylaws to allow for more diverse housing types like townhomes, duplexes, and low-rise apartments, Burlington maintains predominantly single-family detached zoning across most residential areas. This artificial constraint on housing supply directly contributes to our sky-high price-to-income ratio and critically low vacancy rates. The data clearly shows that municipalities with more flexible zoning policies have been able to approve and construct housing at much higher rates per capita. Burlington's outdated zoning not only limits new construction but also prevents the natural evolution of neighborhoods to include more affordable options for young families, seniors looking to downsize, and essential workers. Without significant zoning reform to allow for gentle density and missing middle housing types, Burlington will continue to fall further behind our regional neighbors in addressing the housing affordability crisis.</p>
          </div>
        </div>
      </div>

      <!-- Rental Trends with Explanation on the Left -->
      <div class="flex flex-col lg:flex-row gap-8">
        <div class="w-full lg:w-1/3 flex items-center">
          <!-- Explanation Section for Rental Trends (on the left) -->
          <div class="bg-navy-900 text-white rounded-xl p-6 h-full">
            <h3 class="text-xl font-semibold mb-3">The Rental Crunch</h3>
            <p class="text-sm">Burlington's zoning restrictions have created a perfect storm in our rental market, where demand drastically outstrips supply. With over 80% of residential land zoned exclusively for single-family homes, there are extremely limited opportunities to build new rental apartments, townhomes, or secondary suites. This artificial scarcity has driven vacancy rates to crisis levels below 2%, far under the healthy market threshold of 3-4%. Landlords face little competition, allowing them to increase rents at rates that far exceed income growth. The problem is particularly acute for affordable rental units - without zoning that allows for smaller units, garden suites, or converted dwellings, low and middle-income renters are being priced out of our community entirely. This rental crunch impacts our local economy, making it difficult for businesses to attract and retain employees who cannot find affordable housing. Essential workers like teachers, nurses, and service industry staff face increasingly long commutes as they're forced to seek housing in more affordable communities. Without zoning reforms that specifically allow for more rental housing options, Burlington's rental market will continue to favor landlords at the expense of tenants</p>
          </div>
        </div>
        <div class="w-full lg:w-2/3">
          <section class="bg-white rounded-xl shadow-md p-6 h-full">
            <h2 class="text-2xl font-semibold text-navy-900">Rental Trends</h2>
            <p class="text-slate-600 mt-1">Average rents have climbed while vacancy remains tight.</p>
            <div class="grid md:grid-cols-2 gap-6 mt-4">
              <div>
                <h3 class="font-medium mb-2 text-navy-900">Average Rent (2 Bedroom)</h3>
                <div class="h-64"><canvas id="rent-chart"></canvas></div>
              </div>
              <div>
                <h3 class="font-medium mb-2 text-navy-900">Vacancy Rate (Total)</h3>
                <div class="h-64"><canvas id="vacancy-chart"></canvas></div>
              </div>
            </div>
            <p class="text-sm text-slate-500 mt-3">Source: CMHC Rental Market Survey (2011–2024).</p>
          </section>
        </div>
      </div>

      <!-- Call to Action -->
      <section class="rounded-2xl p-8 bg-navy-900 shadow-lg">
        <h2 class="text-3xl font-bold text-white">This crisis demands action</h2>
        <p class="text-lg mt-2 max-w-3xl text-slate-200">The numbers are clear: we need more homes, faster. Explore the solutions and help move Burlington forward. Navigate BuildBurlington to see how the missing middle will solve the housing crisis in Burlington</p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="/solution" class="px-6 py-3 bg-yellow-400 text-gray-900 rounded-lg font-semibold hover:bg-yellow-500">Explore the Solution</a>
          <a href="/action" class="px-6 py-3 border border-white text-white rounded-lg font-semibold hover:bg-yellow-400 hover:text-gray-900">Take Action Now</a>
        </div>
      </section>

    </div>
  </main>

  <footer class="bg-slate-900 text-slate-300">
    <div class="max-w-6xl mx-auto px-4 py-10 flex flex-col md:flex-row items-center justify-between gap-4">
      <div>
        <div class="text-xl font-bold text-white">BuildBurlington</div>
        <div class="text-slate-400 text-sm">A campaign for housing solutions</div>
      </div>
      <div class="flex gap-6 text-sm">
        <a href="#" class="hover:text-white">Privacy Policy</a>
        <a href="#" class="hover:text-white">Contact</a>
        <a href="/sources" class="hover:text-white">Data Sources</a>
      </div>
    </div>
    <div class="border-t border-slate-800">
      <div class="max-w-6xl mx-auto px-4 py-6 text-center text-slate-500 text-sm">
        © 2024 BuildBurlington. Data: CMHC, Statistics Canada, City of Burlington.
      </div>
    </div>
  </footer>

  <script>
  // ------- Globals
  let priceIncomeChart = null;
  let comparisonChart = null;
  let rentChart = null;
  let vacancyChart = null;
  let timelineVRChart = null;
  let timelinePopChart = null;

  // Utilities
  const parseNum = (v) => (typeof v === 'number' ? v : parseFloat(String(v).replace(/[^0-9.\-]/g, '')));
  const moneyFmt = (n) => n != null && !isNaN(n) ? '$' + Math.round(n).toLocaleString() : '—';
  const pctFmt   = (n) => n != null && !isNaN(n) ? (Math.round(n * 10) / 10) + '%' : '—';

  // Toggle price/income chart datasets
  function updateChartType(type) {
    if (!priceIncomeChart) return;

    // Update button styles
    document.querySelectorAll('#chart-toggle-buttons button').forEach(btn => {
      btn.classList.remove('bg-blue-100','text-blue-700');
      btn.classList.add('bg-gray-100','text-gray-700');
    });
    
    // Find and activate the clicked button
    const activeButton = Array.from(document.querySelectorAll('#chart-toggle-buttons button')).find(btn => 
      btn.getAttribute('onclick').includes(`'${type}'`)
    );
    
    if (activeButton) {
      activeButton.classList.remove('bg-gray-100', 'text-gray-700');
      activeButton.classList.add('bg-blue-100', 'text-blue-700');
    }

    // Update chart visibility based on selected type
    if (type === 'both') {
      priceIncomeChart.data.datasets[0].hidden = false;
      priceIncomeChart.data.datasets[1].hidden = false;
    } else if (type === 'price') {
      priceIncomeChart.data.datasets[0].hidden = false;
      priceIncomeChart.data.datasets[1].hidden = true;
    } else if (type === 'income') {
      priceIncomeChart.data.datasets[0].hidden = true;
      priceIncomeChart.data.datasets[1].hidden = false;
    }
    
    priceIncomeChart.update();
  }

  // Hardcoded data for charts - starting from 2011
  const housingPrices = [
    {Year: "2011", MedianPrice: 400000, Source: "Estimated"},
    {Year: "2012", MedianPrice: 415000, Source: "Estimated"},
    {Year: "2013", MedianPrice: 435000, Source: "Estimated"},
    {Year: "2014", MedianPrice: 460000, Source: "Estimated"},
    {Year: "2015", MedianPrice: 510000, Source: "Estimated"},
    {Year: "2016", MedianPrice: 580000, Source: "Estimated"},
    {Year: "2017", MedianPrice: 650000, Source: "Estimated"},
    {Year: "2018", MedianPrice: 720000, Source: "Estimated"},
    {Year: "2019", MedianPrice: 780000, Source: "Estimated"},
    {Year: "2020", MedianPrice: 850000, Source: "Estimated"},
    {Year: "2021", MedianPrice: 1050000, Source: "Estimated"},
    {Year: "2022", MedianPrice: 1150000, Source: "Estimated"},
    {Year: "2023", MedianPrice: 1100000, Source: "Estimated"},
    {Year: "2024", MedianPrice: 1050000, Source: "Estimated"}
  ];

  const incomeData = [
    {Year: "2011", MedianIncome: 79000.0},
    {Year: "2012", MedianIncome: 79600.0},
    {Year: "2013", MedianIncome: 77900.0},
    {Year: "2014", MedianIncome: 81500.0},
    {Year: "2015", MedianIncome: 80800.0},
    {Year: "2016", MedianIncome: 80700.0},
    {Year: "2017", MedianIncome: 83400.0},
    {Year: "2018", MedianIncome: 85900.0},
    {Year: "2019", MedianIncome: 84800.0},
    {Year: "2020", MedianIncome: 91100.0},
    {Year: "2021", MedianIncome: 92000.0},
    {Year: "2022", MedianIncome: 87700.0},
    {Year: "2023", MedianIncome: 89300.0}
  ];

  const comparisonData = [
    {City: 'Burlington', Price_to_Income_Ratio: 12.32, Avg_Rent_2Bedroom_2024: 1993, Housing_Starts_Per_1000_People: 1.2, Vacancy_Rate_2024_Pct: 1.8},
    {City: 'Oakville', Price_to_Income_Ratio: 10.8, Avg_Rent_2Bedroom_2024: 2100, Housing_Starts_Per_1000_People: 1.4, Vacancy_Rate_2024_Pct: 1.5},
    {City: 'Milton', Price_to_Income_Ratio: 9.05, Avg_Rent_2Bedroom_2024: 1850, Housing_Starts_Per_1000_People: 3.1, Vacancy_Rate_2024_Pct: 1.9},
    {City: 'Hamilton', Price_to_Income_Ratio: 9.62, Avg_Rent_2Bedroom_2024: 1650, Housing_Starts_Per_1000_People: 2.8, Vacancy_Rate_2024_Pct: 2.1},
    {City: 'Mississauga', Price_to_Income_Ratio: 11.53, Avg_Rent_2Bedroom_2024: 1950, Housing_Starts_Per_1000_People: 2.5, Vacancy_Rate_2024_Pct: 1.7},
    {City: 'Toronto', Price_to_Income_Ratio: 12.35, Avg_Rent_2Bedroom_2024: 2100, Housing_Starts_Per_1000_People: 3.0, Vacancy_Rate_2024_Pct: 1.6},
    {City: 'London', Price_to_Income_Ratio: 8.61, Avg_Rent_2Bedroom_2024: 1550, Housing_Starts_Per_1000_People: 2.7, Vacancy_Rate_2024_Pct: 2.3},
    {City: 'Kitchener', Price_to_Income_Ratio: 8.29, Avg_Rent_2Bedroom_2024: 1700, Housing_Starts_Per_1000_People: 3.2, Vacancy_Rate_2024_Pct: 2.0},
    {City: 'Cambridge', Price_to_Income_Ratio: 8.33, Avg_Rent_2Bedroom_2024: 1600, Housing_Starts_Per_1000_People: 2.9, Vacancy_Rate_2024_Pct: 2.2},
    {City: 'Guelph', Price_to_Income_Ratio: 8.89, Avg_Rent_2Bedroom_2024: 1750, Housing_Starts_Per_1000_People: 2.8, Vacancy_Rate_2024_Pct: 2.1},
    {City: 'Barrie', Price_to_Income_Ratio: 8.72, Avg_Rent_2Bedroom_2024: 1700, Housing_Starts_Per_1000_People: 2.6, Vacancy_Rate_2024_Pct: 2.2},
    {City: 'Oshawa', Price_to_Income_Ratio: 9.87, Avg_Rent_2Bedroom_2024: 1800, Housing_Starts_Per_1000_People: 2.7, Vacancy_Rate_2024_Pct: 2.0},
    {City: 'Whitby', Price_to_Income_Ratio: 10.0, Avg_Rent_2Bedroom_2024: 1850, Housing_Starts_Per_1000_People: 2.4, Vacancy_Rate_2024_Pct: 1.9},
    {City: 'Ajax', Price_to_Income_Ratio: 10.0, Avg_Rent_2Bedroom_2024: 1900, Housing_Starts_Per_1000_People: 2.3, Vacancy_Rate_2024_Pct: 1.8}
  ];

  const rentData = [
    {Year: "2011", Rent_2Bedroom: 1097},
    {Year: "2012", Rent_2Bedroom: 1123},
    {Year: "2013", Rent_2Bedroom: 1154},
    {Year: "2014", Rent_2Bedroom: 1203},
    {Year: "2015", Rent_2Bedroom: 1266},
    {Year: "2016", Rent_2Bedroom: 1290},
    {Year: "2017", Rent_2Bedroom: 1365},
    {Year: "2018", Rent_2Bedroom: 1405},
    {Year: "2019", Rent_2Bedroom: 1511},
    {Year: "2020", Rent_2Bedroom: 1623},
    {Year: "2011", Rent_2Bedroom: 1631},
    {Year: "2012", Rent_2Bedroom: 1757},
    {Year: "2013", Rent_2Bedroom: 1823},
    {Year: "2014", Rent_2Bedroom: 1993}
  ];

  const vacancyData = [
    {Year: "2011", Vacancy_Rate: 0.9},
    {Year: "2012", Vacancy_Rate: 1.3},
    {Year: "2013", Vacancy_Rate: 1.8},
    {Year: "2014", Vacancy_Rate: 1.3},
    {Year: "2015", Vacancy_Rate: 1.7},
    {Year: "2016", Vacancy_Rate: 1.1},
    {Year: "2017", Vacancy_Rate: 1.3},
    {Year: "2018", Vacancy_Rate: 1.7},
    {Year: "2019", Vacancy_Rate: 1.7},
    {Year: "2020", Vacancy_Rate: 2.0},
    {Year: "2011", Vacancy_Rate: 1.2},
    {Year: "2012", Vacancy_Rate: 1.2},
    {Year: "2013", Vacancy_Rate: 1.6},
    {Year: "2014", Vacancy_Rate: 1.8}
  ];

  const housingGapData = [
    {Year: "2011", HousingGap: 4549},
    {Year: "2012", HousingGap: 5785},
    {Year: "2013", HousingGap: 5489},
    {Year: "2014", HousingGap: 5665},
    {Year: "2015", HousingGap: 5654},
    {Year: "2016", HousingGap: 5960},
    {Year: "2017", HousingGap: 5743},
    {Year: "2018", HousingGap: 5547},
    {Year: "2019", HousingGap: 6061},
    {Year: "2020", HousingGap: 6109},
    {Year: "2011", HousingGap: 5673},
    {Year: "2012", HousingGap: 8011},
    {Year: "2013", HousingGap: 7725},
    {Year: "2014", HousingGap: 7947}
  ];

  // Process comparison data
  const processComparisonData = (metric) => {
    return comparisonData.map(city => ({
      label: city.City,
      value: city[metric],
      isBurlington: city.City === 'Burlington'
    })).sort((a, b) => b.value - a.value);
  };

  // Update comparison chart
  function updateComparisonChart() {
    const metric = document.getElementById('metric-select').value;
    const data = processComparisonData(metric);
    
    if (comparisonChart) comparisonChart.destroy();
    
    const ctx = document.getElementById('comparison-chart').getContext('2d');
    comparisonChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.map(d => d.label),
        datasets: [{
          data: data.map(d => d.value),
          backgroundColor: data.map(d => d.isBurlington ? '#1a365d' : '#3b82f6'),
          borderWidth: 0
        }]
      },
      options: {
        indexAxis: 'y',
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                const value = context.raw;
                if (metric === 'Price_to_Income_Ratio') return value.toFixed(2) + '×';
                if (metric === 'Avg_Rent_2Bedroom_2024') return '$' + value;
                if (metric === 'Housing_Starts_Per_1000_People') return value;
                if (metric === 'Vacancy_Rate_2024_Pct') return value + '%';
                return value;
              }
            }
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: metric === 'Price_to_Income_Ratio' ? 'Price-to-Income Ratio' : 
                    metric === 'Avg_Rent_2Bedroom_2024' ? 'Average Rent ($)' :
                    metric === 'Housing_Starts_Per_1000_People' ? 'Housing Starts per 1000 People' :
                    'Vacancy Rate (%)'
            }
          }
        }
      }
    });
  }

  // Initialize charts
  function initCharts() {
    // Price vs Income Chart - using same y-axis for both datasets
    const priceIncomeCtx = document.getElementById('price-income-chart').getContext('2d');
    priceIncomeChart = new Chart(priceIncomeCtx, {
      type: 'line',
      data: {
        labels: housingPrices.filter(d => d.Year <= 2023).map(d => d.Year),
        datasets: [
          {
            label: 'Median Home Price',
            data: housingPrices.filter(d => d.Year <= 2023).map(d => d.MedianPrice),
            borderColor: '#dc2626',
            backgroundColor: 'rgba(220, 38, 38, 0.1)',
            fill: true,
            tension: 0.3,
            yAxisID: 'y'
          },
          {
            label: 'Median Household Income',
            data: incomeData.map(d => d.MedianIncome),
            borderColor: '#059669',
            backgroundColor: 'rgba(5, 150, 105, 0.1)',
            fill: true,
            tension: 0.3,
            yAxisID: 'y'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        scales: {
          x: { grid: { display: false } },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: { display: true, text: 'Dollars ($)' },
            grid: { color: 'rgba(0,0,0,0.05)' },
            ticks: {
              callback: function(value) {
                return '$' + value.toLocaleString();
              }
            }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.dataset.label || '';
                if (label) label += ': ';
                label += '$' + context.raw.toLocaleString();
                return label;
              }
            }
          }
        }
      }
    });

    // Comparison Chart
    updateComparisonChart();

    // Rent Chart
    const rentCtx = document.getElementById('rent-chart').getContext('2d');
    rentChart = new Chart(rentCtx, {
      type: 'line',
      data: {
        labels: rentData.map(d => d.Year),
        datasets: [{
          label: 'Average Rent (2 Bedroom)',
          data: rentData.map(d => d.Rent_2Bedroom),
          borderColor: '#1e40af',
          backgroundColor: 'rgba(30, 64, 175, 0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            title: { display: true, text: 'Rent ($)' },
            grid: { color: 'rgba(0,0,0,0.05)' }
          },
          x: { grid: { display: false } }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                return '$' + context.raw;
              }
            }
          }
        }
      }
    });

    // Vacancy Chart
    const vacancyCtx = document.getElementById('vacancy-chart').getContext('2d');
    vacancyChart = new Chart(vacancyCtx, {
      type: 'line',
      data: {
        labels: vacancyData.map(d => d.Year),
        datasets: [{
          label: 'Vacancy Rate',
          data: vacancyData.map(d => d.Vacancy_Rate),
          borderColor: '#dc2626',
          backgroundColor: 'rgba(220, 38, 38, 0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            title: { display: true, text: 'Vacancy Rate (%)' },
            grid: { color: 'rgba(0,0,0,0.05)' }
          },
          x: { grid: { display: false } }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.raw + '%';
              }
            }
          }
        }
      }
    });

    // Timeline Charts
    const timelineVRCtx = document.getElementById('timeline-vr-chart').getContext('2d');
    timelineVRChart = new Chart(timelineVRCtx, {
      type: 'line',
      data: {
        labels: housingPrices.map(d => d.Year),
        datasets: [{
          label: 'Average Housing Price',
          data: housingPrices.map(d => d.MedianPrice),
          borderColor: '#1e40af',
          backgroundColor: 'rgba(30, 64, 175, 0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            title: { display: true, text: 'Price ($)' },
            grid: { color: 'rgba(0,0,0,0.05)' },
            ticks: {
              callback: function(value) {
                return '$' + value.toLocaleString();
              }
            }
          },
          x: { grid: { display: false } }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                return '$' + context.raw.toLocaleString();
              }
            }
          }
        }
      }
    });

    // Housing Gap Chart (no population data) - starting from 2011
    const timelinePopCtx = document.getElementById('timeline-pop-chart').getContext('2d');
    timelinePopChart = new Chart(timelinePopCtx, {
      type: 'line',
      data: {
        labels: housingGapData.map(d => d.Year),
        datasets: [
          {
            label: 'Housing Gap',
            data: housingGapData.map(d => d.HousingGap),
            borderColor: '#dc2626',
            backgroundColor: 'rgba(220, 38, 38, 0.1)',
            fill: true,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            title: { display: true, text: 'Housing Units Needed' },
            grid: { color: 'rgba(0,0,0,0.05)' }
          },
          x: { grid: { display: false } }
        }
      }
    });
  }

  // Timeline slider functionality
  function setupTimeline() {
    const slider = document.getElementById('timeline-slider');
    const yearLabel = document.getElementById('timeline-year');
    const vacancyLabel = document.getElementById('kpi-vacancy');
    const populationLabel = document.getElementById('kpi-population');
    const gapLabel = document.getElementById('kpi-gap');

    function updateTimeline(year) {
      yearLabel.textContent = year;
      
      // Update vacancy
      const vacancy = vacancyData.find(d => d.Year === year.toString());
      vacancyLabel.textContent = vacancy ? pctFmt(vacancy.Vacancy_Rate) : '—';
      
      // Update population (keeping this for the KPI card only)
      const pop = housingGapData.find(d => d.Year === year.toString());
      populationLabel.textContent = pop ? (180868 + (parseInt(year) - 2011) * 1500).toLocaleString() : '—';
      
      // Update housing gap
      const gap = housingGapData.find(d => d.Year === year.toString());
      gapLabel.textContent = gap ? gap.HousingGap.toLocaleString() : '—';
    }

    // Initialize
    updateTimeline(slider.value);

    // Add event listener
    slider.addEventListener('input', () => {
      updateTimeline(slider.value);
    });
  }

  // Hamburger menu toggle
  function setupHamburger() {
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    
    hamburgerBtn.addEventListener('click', () => {
      hamburgerBtn.classList.toggle('hamburger-active');
      mobileMenu.classList.toggle('mobile-menu-open');
    });
  }

  // Initialize everything when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    initCharts();
    setupTimeline();
    setupHamburger();
    
    // Add event listener for metric select
    document.getElementById('metric-select').addEventListener('change', updateComparisonChart);
    
    // Set initial active button state
    document.querySelector('#chart-toggle-buttons button[onclick="updateChartType(\'both\')"]').classList.add('bg-blue-100', 'text-blue-700');
  });
  </script>
</body>
</html>